{"ast":null,"code":"var _jsxFileName = \"/Users/yati/Desktop/react/Content-Zila/react-front/src/user/EditProfile.js\";\nimport React, { Component } from \"react\";\nimport { isAuthenticated } from \"../auth\";\nimport { read, update, updateUser } from \"./apiUser\";\nimport { Redirect } from \"react-router-dom\";\nimport DefaultProfile from \"../images/avatar.jpg\";\n\nclass EditProfile extends Component {\n  constructor() {\n    super();\n\n    this.init = userId => {\n      const token = isAuthenticated().token;\n      read(userId, token).then(data => {\n        if (data.error) {\n          this.setState({\n            redirectToProfile: true\n          });\n        } else {\n          this.setState({\n            id: data._id,\n            name: data.name,\n            email: data.email,\n            error: \"\",\n            about: data.about\n          });\n        }\n      });\n    };\n\n    this.isValid = () => {\n      const {\n        name,\n        email,\n        password,\n        fileSize\n      } = this.state;\n\n      if (fileSize > 1000000) {\n        this.setState({\n          error: \"File size should be less than 100kb\",\n          loading: false\n        });\n        return false;\n      }\n\n      if (name.length === 0) {\n        this.setState({\n          error: \"Name is required\",\n          loading: false\n        });\n        return false;\n      } // email@domain.com\n\n\n      if (!/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(email)) {\n        this.setState({\n          error: \"A valid Email is required\",\n          loading: false\n        });\n        return false;\n      }\n\n      if (password.length >= 1 && password.length <= 5) {\n        this.setState({\n          error: \"Password must be at least 6 characters long\",\n          loading: false\n        });\n        return false;\n      }\n\n      return true;\n    };\n\n    this.handleChange = name => event => {\n      this.setState({\n        error: \"\"\n      });\n      const value = name === \"photo\" ? event.target.files[0] : event.target.value;\n      const fileSize = name === \"photo\" ? event.target.files[0].size : 0;\n      this.userData.set(name, value);\n      this.setState({\n        [name]: value,\n        fileSize\n      });\n    };\n\n    this.clickSubmit = event => {\n      event.preventDefault();\n      this.setState({\n        loading: true\n      });\n\n      if (this.isValid()) {\n        const userId = this.props.match.params.userId;\n        const token = isAuthenticated().token;\n        update(userId, token, this.userData).then(data => {\n          if (data.error) {\n            this.setState({\n              error: data.error\n            });\n          } else if (isAuthenticated().user.role === \"admin\") {\n            this.setState({\n              redirectToProfile: true\n            });\n          } else {\n            updateUser(data, () => {\n              this.setState({\n                redirectToProfile: true\n              });\n            });\n          }\n        });\n      }\n    };\n\n    this.signupForm = (name, email, password, about) => /*#__PURE__*/React.createElement(\"form\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 9\n      }\n    }, \"Profile Photo\"), /*#__PURE__*/React.createElement(\"input\", {\n      onChange: this.handleChange(\"photo\"),\n      type: \"file\",\n      accept: \"image/*\",\n      className: \"form-control\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }\n    }, \"Name\"), /*#__PURE__*/React.createElement(\"input\", {\n      onChange: this.handleChange(\"name\"),\n      type: \"text\",\n      className: \"form-control\",\n      value: name,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }\n    }, \"Email\"), /*#__PURE__*/React.createElement(\"input\", {\n      onChange: this.handleChange(\"email\"),\n      type: \"email\",\n      className: \"form-control\",\n      value: email,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }\n    }, \"About\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      onChange: this.handleChange(\"about\"),\n      type: \"text\",\n      className: \"form-control\",\n      value: about,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 9\n      }\n    }, \"Password\"), /*#__PURE__*/React.createElement(\"input\", {\n      onChange: this.handleChange(\"password\"),\n      type: \"password\",\n      className: \"form-control\",\n      value: password,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.clickSubmit,\n      className: \"btn btn-raised btn-primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 7\n      }\n    }, \"Update\"));\n\n    this.state = {\n      id: \"\",\n      name: \"\",\n      email: \"\",\n      password: \"\",\n      redirectToProfile: false,\n      error: \"\",\n      fileSize: 0,\n      loading: false,\n      about: \"\"\n    };\n  }\n\n  componentDidMount() {\n    this.userData = new FormData();\n    const userId = this.props.match.params.userId;\n    this.init(userId);\n  }\n\n  render() {\n    const {\n      id,\n      name,\n      email,\n      password,\n      redirectToProfile,\n      error,\n      loading,\n      about\n    } = this.state;\n\n    if (redirectToProfile) {\n      return /*#__PURE__*/React.createElement(Redirect, {\n        to: `/user/${id}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 14\n        }\n      });\n    }\n\n    const photoUrl = id ? `${process.env.REACT_APP_API_URL}/user/photo/${id}?${new Date().getTime()}` : DefaultProfile;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      className: \"mt-5 mb-5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }\n    }, \"Edit Profile\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"alert alert-danger\",\n      style: {\n        display: error ? \"\" : \"none\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 9\n      }\n    }, error), loading ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"jumbotron text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 13\n      }\n    }, \"Loading...\")) : \"\", /*#__PURE__*/React.createElement(\"img\", {\n      style: {\n        height: \"200px\",\n        width: \"auto\"\n      },\n      className: \"img-thumbnail\",\n      src: photoUrl,\n      onError: i => i.target.src = `${DefaultProfile}`,\n      alt: name,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 9\n      }\n    }), this.signupForm(name, email, password, about));\n  }\n\n}\n\nexport default EditProfile;","map":{"version":3,"sources":["/Users/yati/Desktop/react/Content-Zila/react-front/src/user/EditProfile.js"],"names":["React","Component","isAuthenticated","read","update","updateUser","Redirect","DefaultProfile","EditProfile","constructor","init","userId","token","then","data","error","setState","redirectToProfile","id","_id","name","email","about","isValid","password","fileSize","state","loading","length","test","handleChange","event","value","target","files","size","userData","set","clickSubmit","preventDefault","props","match","params","user","role","signupForm","componentDidMount","FormData","render","photoUrl","process","env","REACT_APP_API_URL","Date","getTime","display","height","width","i","src"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { isAuthenticated } from \"../auth\";\nimport { read, update, updateUser } from \"./apiUser\";\nimport { Redirect } from \"react-router-dom\";\nimport DefaultProfile from \"../images/avatar.jpg\";\n\nclass EditProfile extends Component {\n  constructor() {\n    super();\n    this.state = {\n      id: \"\",\n      name: \"\",\n      email: \"\",\n      password: \"\",\n      redirectToProfile: false,\n      error: \"\",\n      fileSize: 0,\n      loading: false,\n      about: \"\"\n    };\n  }\n\n  init = userId => {\n    const token = isAuthenticated().token;\n    read(userId, token).then(data => {\n      if (data.error) {\n        this.setState({ redirectToProfile: true });\n      } else {\n        this.setState({\n          id: data._id,\n          name: data.name,\n          email: data.email,\n          error: \"\",\n          about: data.about\n        });\n      }\n    });\n  };\n\n  componentDidMount() {\n    this.userData = new FormData();\n    const userId = this.props.match.params.userId;\n    this.init(userId);\n  }\n\n  isValid = () => {\n    const { name, email, password, fileSize } = this.state;\n    if (fileSize > 1000000) {\n      this.setState({\n        error: \"File size should be less than 100kb\",\n        loading: false\n      });\n      return false;\n    }\n    if (name.length === 0) {\n      this.setState({ error: \"Name is required\", loading: false });\n      return false;\n    }\n    // email@domain.com\n    if (!/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(email)) {\n      this.setState({\n        error: \"A valid Email is required\",\n        loading: false\n      });\n      return false;\n    }\n    if (password.length >= 1 && password.length <= 5) {\n      this.setState({\n        error: \"Password must be at least 6 characters long\",\n        loading: false\n      });\n      return false;\n    }\n    return true;\n  };\n\n  handleChange = name => event => {\n    this.setState({ error: \"\" });\n    const value = name === \"photo\" ? event.target.files[0] : event.target.value;\n\n    const fileSize = name === \"photo\" ? event.target.files[0].size : 0;\n    this.userData.set(name, value);\n    this.setState({ [name]: value, fileSize });\n  };\n\n  clickSubmit = event => {\n    event.preventDefault();\n    this.setState({ loading: true });\n\n    if (this.isValid()) {\n      const userId = this.props.match.params.userId;\n      const token = isAuthenticated().token;\n\n      update(userId, token, this.userData).then(data => {\n        if (data.error) {\n          this.setState({ error: data.error });\n        } else if (isAuthenticated().user.role === \"admin\") {\n          this.setState({\n            redirectToProfile: true\n          });\n        } else {\n          updateUser(data, () => {\n            this.setState({\n              redirectToProfile: true\n            });\n          });\n        }\n      });\n    }\n  };\n\n  signupForm = (name, email, password, about) => (\n    <form>\n      <div className=\"form-group\">\n        <label className=\"text-muted\">Profile Photo</label>\n        <input\n          onChange={this.handleChange(\"photo\")}\n          type=\"file\"\n          accept=\"image/*\"\n          className=\"form-control\"\n        />\n      </div>\n      <div className=\"form-group\">\n        <label className=\"text-muted\">Name</label>\n        <input\n          onChange={this.handleChange(\"name\")}\n          type=\"text\"\n          className=\"form-control\"\n          value={name}\n        />\n      </div>\n      <div className=\"form-group\">\n        <label className=\"text-muted\">Email</label>\n        <input\n          onChange={this.handleChange(\"email\")}\n          type=\"email\"\n          className=\"form-control\"\n          value={email}\n        />\n      </div>\n\n      <div className=\"form-group\">\n        <label className=\"text-muted\">About</label>\n        <textarea\n          onChange={this.handleChange(\"about\")}\n          type=\"text\"\n          className=\"form-control\"\n          value={about}\n        />\n      </div>\n\n      <div className=\"form-group\">\n        <label className=\"text-muted\">Password</label>\n        <input\n          onChange={this.handleChange(\"password\")}\n          type=\"password\"\n          className=\"form-control\"\n          value={password}\n        />\n      </div>\n      <button onClick={this.clickSubmit} className=\"btn btn-raised btn-primary\">\n        Update\n      </button>\n    </form>\n  );\n\n  render() {\n    const {\n      id,\n      name,\n      email,\n      password,\n      redirectToProfile,\n      error,\n      loading,\n      about\n    } = this.state;\n\n    if (redirectToProfile) {\n      return <Redirect to={`/user/${id}`} />;\n    }\n\n    const photoUrl = id\n      ? `${\n          process.env.REACT_APP_API_URL\n        }/user/photo/${id}?${new Date().getTime()}`\n      : DefaultProfile;\n\n    return (\n      <div className=\"container\">\n        <h2 className=\"mt-5 mb-5\">Edit Profile</h2>\n        <div\n          className=\"alert alert-danger\"\n          style={{ display: error ? \"\" : \"none\" }}\n        >\n          {error}\n        </div>\n\n        {loading ? (\n          <div className=\"jumbotron text-center\">\n            <h2>Loading...</h2>\n          </div>\n        ) : (\n          \"\"\n        )}\n\n        <img\n          style={{ height: \"200px\", width: \"auto\" }}\n          className=\"img-thumbnail\"\n          src={photoUrl}\n          onError={i => (i.target.src = `${DefaultProfile}`)}\n          alt={name}\n        />\n\n          {this.signupForm(name, email, password, about)}\n      </div>\n    );\n  }\n}\n\nexport default EditProfile;\n"]},"metadata":{},"sourceType":"module"}